<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ruoyi.business.mapper.CWithdrawMapper" >
  <resultMap id="BaseResultMap" type="com.ruoyi.business.model.CWithdraw" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="uid" property="uid" jdbcType="BIGINT" />
    <result column="currency" property="currency" jdbcType="VARCHAR" />
    <result column="currency_id" property="currencyId" jdbcType="BIGINT" />
    <result column="amount" property="amount" jdbcType="DECIMAL" />
    <result column="fee" property="fee" jdbcType="DECIMAL" />
    <result column="last_amount" property="lastAmount" jdbcType="DECIMAL" />
    <result column="hash" property="hash" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="audit_time" property="auditTime" jdbcType="TIMESTAMP" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="reward_id" property="rewardId" jdbcType="BIGINT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <select id="getTodayCount" resultType="java.lang.Integer">
    select count(1) from c_withdraw where address=#{address} and to_days(create_time)=to_days(now())
  </select>

  <select id="getWithdrawList" resultMap="BaseResultMap">
    select t1.* from c_withdraw t1
    where 1=1
    <if test="address !=null and address !=''">
      and t1.address=lower(#{address})
    </if>
    <if test="startTime !=null">
      and to_days(t1.create_time) >= to_days(#{startTime})
    </if>
    <if test="endTime !=null">
      and to_days(t1.create_time) &lt;= to_days(#{endTime})
    </if>
    <if test="coin !=null and coin !=''">
      and t1.currency=#{coin}
    </if>
    <if test="status !=null">
      and t1.status=#{status}
    </if>
    <if test="type !=null and type !=''">
      and t1.type=#{type}
    </if>

    order by t1.create_time desc
  </select>

  <select id="getWithdrawListSum" resultType="com.alibaba.fastjson2.JSONObject">
    select ifnull(sum(amount),0) as sumAmount,t1.currency from c_withdraw t1
    where 1=1
    <if test="address !=null and address !=''">
      and t1.address=lower(#{address})
    </if>
    <if test="startTime !=null">
      and to_days(t1.create_time) >= to_days(#{startTime})
    </if>
    <if test="endTime !=null">
      and to_days(t1.create_time) &lt;= to_days(#{endTime})
    </if>
    <if test="coin !=null and coin !=''">
      and t1.currency=#{coin}
    </if>
    <if test="status !=null">
      and t1.status=#{status}
    </if>
    <if test="type !=null and type !=''">
      and t1.type=#{type}
    </if>
    group by t1.currency
  </select>

</mapper>