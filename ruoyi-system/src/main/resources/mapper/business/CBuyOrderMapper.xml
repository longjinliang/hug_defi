<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ruoyi.business.mapper.CBuyOrderMapper" >
  <resultMap id="BaseResultMap" type="com.ruoyi.business.model.CBuyOrder" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="to_address" property="toAddress" jdbcType="VARCHAR" />
    <result column="stage_num" property="stageNum" jdbcType="INTEGER" />
    <result column="coin" property="coin" jdbcType="VARCHAR" />
    <result column="usdt_amount" property="usdtAmount" jdbcType="DECIMAL" />
    <result column="price" property="price" jdbcType="DECIMAL" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="token_amount" property="tokenAmount" jdbcType="DECIMAL" />
    <result column="hash" property="hash" jdbcType="VARCHAR" />
    <result column="login_ip" property="loginIp" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <select id="getUserBuyUsdtAmount" resultType="java.math.BigDecimal">
    select sum(usdt_amount) from c_buy_order where address=#{address}
  </select>

  <select id="getBuyList" resultType="com.alibaba.fastjson2.JSONObject">
    select address,usdt_amount usdtAmount,token_amount tokenAmount,create_time createTime from c_buy_order
    order by id desc
  </select>

  <select id="getMyBuyTokenAmount" resultType="java.math.BigDecimal">
    select sum(token_amount) from c_buy_order where address=#{address}
  </select>

  <select id="getMyBuyUsdtAmount" resultType="java.math.BigDecimal">
    select sum(usdt_amount) from c_buy_order where address=#{address}
  </select>

  <select id="getMyBuyList" resultType="com.alibaba.fastjson2.JSONObject">
    select address,usdt_amount usdtAmount,token_amount tokenAmount,create_time createTime from c_buy_order
            where address=#{address}

    order by id desc
  </select>

  <select id="getBackBuyList" resultMap="BaseResultMap">
    select t1.* from c_buy_order t1
    where 1=1
    <if test="address !=null and address !=''">
      and t1.address=lower(#{address})
    </if>
    <if test="startTime !=null">
      and to_days(t1.create_time) >= to_days(#{startTime})
    </if>
    <if test="endTime !=null">
      and to_days(t1.create_time) &lt;= to_days(#{endTime})
    </if>

    order by t1.create_time desc
  </select>

  <select id="getBackBuyListSum" resultType="com.alibaba.fastjson2.JSONObject">
    select ifnull(sum(token_amount),0) as tokenAmount,ifnull(sum(usdt_amount),0) as usdtAmount from c_buy_order t1
    where 1=1
    <if test="address !=null and address !=''">
      and t1.address=lower(#{address})
    </if>
    <if test="startTime !=null">
      and to_days(t1.create_time) >= to_days(#{startTime})
    </if>
    <if test="endTime !=null">
      and to_days(t1.create_time) &lt;= to_days(#{endTime})
    </if>

  </select>



</mapper>